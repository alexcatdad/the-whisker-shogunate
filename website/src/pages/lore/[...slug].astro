---
import { getCollection } from "astro:content";
import { marked } from "marked";
import LoreEntry from "../../layouts/LoreEntry.astro";

const { slug } = Astro.params;

// Find the entry by slug
const allLore = await getCollection("lore");
const entry = allLore.find((e) => e.id.replace(/\.md$/, "") === slug);

if (!entry) {
  return Astro.redirect(`${import.meta.env.BASE_URL}404`);
}

// Parse markdown to HTML
const content = await marked.parse(entry.body || "");
---

<LoreEntry
  title={entry.data.title}
  category={entry.data.category}
  tags={entry.data.tags}
  updatedAt={entry.data.updatedAt}
>
  <article class="prose" set:html={content} />
</LoreEntry>
