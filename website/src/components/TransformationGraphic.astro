---
/**
 * TransformationGraphic.astro
 * A mystical animated illustration showing the metamorphosis
 * from a small dependent animal to a sentient cat citizen
 * Features swirling light, evolving silhouettes, and ethereal energy
 */

interface Props {
  class?: string;
}

const { class: className } = Astro.props;
---

<div class:list={["transformation-graphic", className]} aria-hidden="true">
  <svg viewBox="0 0 600 300" class="transformation-graphic__svg" preserveAspectRatio="xMidYMid slice">
    <defs>
      <!-- Ethereal gradients -->
      <radialGradient id="mysticalCore" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="var(--color-accent-highlight)" stop-opacity="0.4" />
        <stop offset="40%" stop-color="var(--color-accent-primary)" stop-opacity="0.2" />
        <stop offset="100%" stop-color="var(--color-accent-tertiary)" stop-opacity="0" />
      </radialGradient>

      <radialGradient id="energyBurst" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="var(--color-accent-secondary)" stop-opacity="0.5" />
        <stop offset="60%" stop-color="var(--color-accent-primary)" stop-opacity="0.15" />
        <stop offset="100%" stop-color="transparent" />
      </radialGradient>

      <linearGradient id="pathGlow" x1="0%" y1="50%" x2="100%" y2="50%">
        <stop offset="0%" stop-color="var(--color-accent-tertiary)" stop-opacity="0.1" />
        <stop offset="30%" stop-color="var(--color-accent-primary)" stop-opacity="0.4" />
        <stop offset="70%" stop-color="var(--color-accent-primary)" stop-opacity="0.4" />
        <stop offset="100%" stop-color="var(--color-accent-tertiary)" stop-opacity="0.1" />
      </linearGradient>

      <linearGradient id="spiritGradient" x1="0%" y1="100%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="var(--color-accent-secondary)" stop-opacity="0.8" />
        <stop offset="50%" stop-color="var(--color-accent-primary)" />
        <stop offset="100%" stop-color="var(--color-accent-highlight)" />
      </linearGradient>

      <!-- Glow filters -->
      <filter id="etherealGlow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur stdDeviation="8" result="glow" />
        <feMerge>
          <feMergeNode in="glow" />
          <feMergeNode in="glow" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>

      <filter id="softBlur" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="3" />
      </filter>

      <filter id="spiritGlow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="4" result="blur" />
        <feComposite in="SourceGraphic" in2="blur" operator="over" />
      </filter>

      <!-- Particle pattern -->
      <pattern id="stardust" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
        <circle cx="5" cy="8" r="0.5" fill="var(--color-accent-secondary)" opacity="0.4" />
        <circle cx="25" cy="15" r="0.3" fill="var(--color-accent-primary)" opacity="0.3" />
        <circle cx="12" cy="30" r="0.4" fill="var(--color-accent-highlight)" opacity="0.5" />
        <circle cx="35" cy="35" r="0.3" fill="var(--color-accent-secondary)" opacity="0.3" />
      </pattern>

      <!-- Swirl path for animation -->
      <path id="spiralPath" d="M100,150 Q200,80 300,150 Q400,220 500,150" fill="none" />
    </defs>

    <!-- Background atmosphere -->
    <rect width="100%" height="100%" fill="var(--color-bg-tertiary)" opacity="0.3" />
    <rect width="100%" height="100%" fill="url(#stardust)" class="stardust-layer" />

    <!-- Mystical energy swirls -->
    <g class="energy-swirls">
      <!-- Outer swirl rings -->
      <ellipse class="swirl swirl--1" cx="300" cy="150" rx="200" ry="100"
               fill="none" stroke="var(--color-accent-primary)" stroke-width="0.5" opacity="0.2" />
      <ellipse class="swirl swirl--2" cx="300" cy="150" rx="180" ry="85"
               fill="none" stroke="var(--color-accent-secondary)" stroke-width="0.5" opacity="0.25" />
      <ellipse class="swirl swirl--3" cx="300" cy="150" rx="160" ry="70"
               fill="none" stroke="var(--color-accent-primary)" stroke-width="0.5" opacity="0.3" />

      <!-- Energy ribbons -->
      <path class="ribbon ribbon--1"
            d="M80 150 Q140 80 200 120 Q260 160 300 140 Q340 120 400 150 Q460 180 520 130"
            fill="none" stroke="url(#pathGlow)" stroke-width="3" stroke-linecap="round" />
      <path class="ribbon ribbon--2"
            d="M60 180 Q120 220 180 170 Q240 120 300 160 Q360 200 420 140 Q480 80 540 120"
            fill="none" stroke="url(#pathGlow)" stroke-width="2" stroke-linecap="round" opacity="0.6" />
    </g>

    <!-- Central transformation zone -->
    <g class="transform-zone">
      <!-- Mystical core glow -->
      <circle class="core-glow core-glow--outer" cx="300" cy="150" r="80"
              fill="url(#mysticalCore)" filter="url(#softBlur)" />
      <circle class="core-glow core-glow--inner" cx="300" cy="150" r="50"
              fill="url(#energyBurst)" />
    </g>

    <!-- Stage 1: Small dependent cat (left) -->
    <g class="cat-stage cat-stage--1" transform="translate(100, 180)">
      <!-- Small curled up cat -->
      <g class="small-cat" fill="var(--color-accent-tertiary)" opacity="0.8">
        <!-- Curled body -->
        <ellipse cx="0" cy="0" rx="22" ry="15" />
        <!-- Head tucked in -->
        <circle cx="-12" cy="-8" r="12" />
        <!-- Ears -->
        <path d="M-20 -16 L-17 -25 L-12 -18" />
        <path d="M-8 -18 L-5 -26 L-2 -18" />
        <!-- Tail wrapped around -->
        <path d="M18 5 Q30 15 25 -5 Q20 -20 10 -15"
              stroke="var(--color-accent-tertiary)" stroke-width="5" fill="none" stroke-linecap="round" />
        <!-- Closed eyes (peaceful) -->
        <path d="M-17 -8 Q-15 -10 -13 -8" stroke="var(--color-bg-primary)" stroke-width="1.5" fill="none" />
        <path d="M-11 -6 Q-9 -8 -7 -6" stroke="var(--color-bg-primary)" stroke-width="1.5" fill="none" />
      </g>

      <!-- Memory fragments floating up -->
      <g class="memories">
        <circle class="memory memory--1" cx="-5" cy="-40" r="3"
                fill="var(--color-accent-highlight)" opacity="0.3" />
        <circle class="memory memory--2" cx="10" cy="-50" r="2"
                fill="var(--color-accent-secondary)" opacity="0.25" />
        <circle class="memory memory--3" cx="-15" cy="-55" r="2.5"
                fill="var(--color-accent-primary)" opacity="0.2" />
      </g>

      <!-- Label -->
      <text x="0" y="45" text-anchor="middle" fill="var(--color-text-tertiary)"
            font-family="var(--font-heading)" font-size="9" opacity="0.6">Before</text>
    </g>

    <!-- Stage 2: Transitioning (center) - the mystical moment -->
    <g class="cat-stage cat-stage--2" transform="translate(300, 150)">
      <!-- Ethereal transitioning form -->
      <g class="transitioning-cat" filter="url(#spiritGlow)">
        <!-- Spirit form - between states -->
        <g fill="url(#spiritGradient)" class="spirit-form">
          <!-- Body rising/elongating -->
          <path d="M-15 40 Q-20 20 -18 0 Q-15 -20 0 -35 Q15 -20 18 0 Q20 20 15 40 Z" opacity="0.7" />

          <!-- Head forming -->
          <circle cx="0" cy="-50" r="18" opacity="0.8" />

          <!-- Ears emerging -->
          <path d="M-12 -62 L-8 -78 L-2 -65" opacity="0.8" />
          <path d="M2 -65 L8 -78 L12 -62" opacity="0.8" />

          <!-- Arms beginning to form -->
          <path d="M-18 5 Q-35 0 -40 15" stroke="url(#spiritGradient)" stroke-width="6"
                fill="none" stroke-linecap="round" opacity="0.6" />
          <path d="M18 5 Q35 0 40 15" stroke="url(#spiritGradient)" stroke-width="6"
                fill="none" stroke-linecap="round" opacity="0.6" />
        </g>

        <!-- Transformation particles -->
        <g class="transform-particles">
          <circle class="particle particle--1" cx="-25" cy="-20" r="2" fill="var(--color-accent-highlight)" />
          <circle class="particle particle--2" cx="30" cy="-30" r="1.5" fill="var(--color-accent-secondary)" />
          <circle class="particle particle--3" cx="-15" cy="20" r="1.8" fill="var(--color-accent-primary)" />
          <circle class="particle particle--4" cx="20" cy="15" r="2" fill="var(--color-accent-highlight)" />
          <circle class="particle particle--5" cx="-30" cy="5" r="1.5" fill="var(--color-accent-secondary)" />
          <circle class="particle particle--6" cx="25" cy="-5" r="1.8" fill="var(--color-accent-primary)" />
        </g>

        <!-- Light rays emanating -->
        <g class="light-rays" stroke="var(--color-accent-secondary)" stroke-width="1" opacity="0.3">
          <line class="ray ray--1" x1="0" y1="-35" x2="0" y2="-90" />
          <line class="ray ray--2" x1="-25" y1="-20" x2="-60" y2="-45" />
          <line class="ray ray--3" x1="25" y1="-20" x2="60" y2="-45" />
          <line class="ray ray--4" x1="-20" y1="10" x2="-55" y2="25" />
          <line class="ray ray--5" x1="20" y1="10" x2="55" y2="25" />
        </g>
      </g>

      <!-- Central transformation burst -->
      <circle class="burst" cx="0" cy="0" r="60" fill="url(#energyBurst)" opacity="0.3" />
    </g>

    <!-- Stage 3: Sentient citizen cat (right) -->
    <g class="cat-stage cat-stage--3" transform="translate(500, 150)">
      <!-- Upright walking cat in traditional attire -->
      <g class="citizen-cat" fill="var(--color-accent-primary)">
        <!-- Body (standing upright) -->
        <path d="M-12 50 L-15 10 Q-15 -10 0 -20 Q15 -10 15 10 L12 50 Z" opacity="0.9" />

        <!-- Head -->
        <circle cx="0" cy="-35" r="16" />

        <!-- Ears (alert, upright) -->
        <path d="M-10 -46 L-7 -60 L-2 -48" />
        <path d="M2 -48 L7 -60 L10 -46" />

        <!-- Eyes (open, aware) -->
        <circle cx="-5" cy="-36" r="3" fill="var(--color-accent-secondary)" />
        <circle cx="5" cy="-36" r="3" fill="var(--color-accent-secondary)" />
        <circle cx="-4" cy="-36" r="1.5" fill="var(--color-bg-primary)" />
        <circle cx="6" cy="-36" r="1.5" fill="var(--color-bg-primary)" />

        <!-- Whiskers -->
        <g stroke="var(--color-accent-tertiary)" stroke-width="0.5" opacity="0.6">
          <line x1="-8" y1="-32" x2="-20" y2="-30" />
          <line x1="-8" y1="-30" x2="-20" y2="-32" />
          <line x1="8" y1="-32" x2="20" y2="-30" />
          <line x1="8" y1="-30" x2="20" y2="-32" />
        </g>

        <!-- Arms (holding something) -->
        <path d="M-15 5 Q-25 10 -28 25 L-22 28 Q-20 15 -12 12"
              fill="var(--color-accent-primary)" opacity="0.85" />
        <path d="M15 5 Q25 10 28 25 L22 28 Q20 15 12 12"
              fill="var(--color-accent-primary)" opacity="0.85" />

        <!-- Simple kimono suggestion -->
        <path d="M-12 5 L0 -5 L12 5" stroke="var(--color-accent-secondary)"
              stroke-width="1.5" fill="none" opacity="0.5" />
        <line x1="0" y1="-5" x2="0" y2="40" stroke="var(--color-accent-secondary)"
              stroke-width="1" opacity="0.4" />

        <!-- Tail (upright, confident) -->
        <path d="M8 45 Q20 40 18 25 Q16 10 25 5"
              stroke="var(--color-accent-primary)" stroke-width="5" fill="none" stroke-linecap="round" />

        <!-- Paws/feet -->
        <ellipse cx="-8" cy="52" rx="5" ry="3" opacity="0.8" />
        <ellipse cx="8" cy="52" rx="5" ry="3" opacity="0.8" />
      </g>

      <!-- Aura of accomplishment -->
      <circle class="aura" cx="0" cy="0" r="45" fill="none"
              stroke="var(--color-accent-secondary)" stroke-width="1" opacity="0.2" />

      <!-- Label -->
      <text x="0" y="80" text-anchor="middle" fill="var(--color-text-tertiary)"
            font-family="var(--font-heading)" font-size="9" opacity="0.6">After</text>
    </g>

    <!-- Connecting journey path -->
    <g class="journey-path">
      <path class="path-line"
            d="M140 180 Q200 120 300 150 Q400 180 460 150"
            fill="none" stroke="url(#pathGlow)" stroke-width="2"
            stroke-dasharray="8,4" opacity="0.5" />

      <!-- Animated traveling spark -->
      <circle class="traveling-spark" r="4" fill="var(--color-accent-highlight)" filter="url(#etherealGlow)">
        <animateMotion dur="6s" repeatCount="indefinite" path="M140,180 Q200,120 300,150 Q400,180 460,150" />
      </circle>
    </g>

    <!-- Floating kanji-style symbols -->
    <g class="symbols" fill="var(--color-accent-tertiary)" opacity="0.15" font-family="var(--font-display)" font-size="24">
      <text class="symbol symbol--1" x="180" y="80" text-anchor="middle">変</text>
      <text class="symbol symbol--2" x="420" y="90" text-anchor="middle">化</text>
    </g>
  </svg>
</div>

<style>
  .transformation-graphic {
    width: 100%;
    max-width: 700px;
    margin-inline: auto;
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: linear-gradient(135deg,
      var(--color-bg-secondary) 0%,
      var(--color-bg-tertiary) 50%,
      var(--color-bg-secondary) 100%
    );
    box-shadow: var(--shadow-lg), var(--shadow-glow);
    border: 1px solid var(--color-border);
  }

  .transformation-graphic__svg {
    display: block;
    width: 100%;
    height: auto;
    min-height: 160px;
  }

  /* Stardust shimmer */
  .stardust-layer {
    animation: stardust-drift 30s linear infinite;
  }

  @keyframes stardust-drift {
    from { transform: translateX(0) translateY(0); }
    to { transform: translateX(-40px) translateY(-40px); }
  }

  /* Swirl animations */
  .swirl {
    transform-origin: center;
  }

  .swirl--1 {
    animation: swirl-rotate 25s linear infinite;
  }

  .swirl--2 {
    animation: swirl-rotate 20s linear infinite reverse;
  }

  .swirl--3 {
    animation: swirl-rotate 15s linear infinite;
  }

  @keyframes swirl-rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Energy ribbons flow */
  .ribbon {
    stroke-dasharray: 200;
    stroke-dashoffset: 200;
    animation: ribbon-flow 8s ease-in-out infinite;
  }

  .ribbon--2 {
    animation-delay: -4s;
  }

  @keyframes ribbon-flow {
    0%, 100% {
      stroke-dashoffset: 200;
      opacity: 0.3;
    }
    50% {
      stroke-dashoffset: 0;
      opacity: 0.8;
    }
  }

  /* Core glow pulse */
  .core-glow--outer {
    animation: core-pulse 4s ease-in-out infinite;
  }

  .core-glow--inner {
    animation: core-pulse 4s ease-in-out infinite 0.5s;
  }

  @keyframes core-pulse {
    0%, 100% {
      transform: scale(1);
      opacity: 0.3;
    }
    50% {
      transform: scale(1.15);
      opacity: 0.5;
    }
  }

  /* Spirit form breathing */
  .spirit-form {
    animation: spirit-breathe 3s ease-in-out infinite;
    transform-origin: center bottom;
  }

  @keyframes spirit-breathe {
    0%, 100% {
      transform: scaleY(1) translateY(0);
      opacity: 0.7;
    }
    50% {
      transform: scaleY(1.03) translateY(-3px);
      opacity: 0.9;
    }
  }

  /* Transform particles orbit */
  .particle {
    animation: particle-orbit 4s ease-in-out infinite;
  }

  .particle--1 { animation-delay: 0s; }
  .particle--2 { animation-delay: -0.7s; }
  .particle--3 { animation-delay: -1.4s; }
  .particle--4 { animation-delay: -2.1s; }
  .particle--5 { animation-delay: -2.8s; }
  .particle--6 { animation-delay: -3.5s; }

  @keyframes particle-orbit {
    0%, 100% {
      transform: translateY(0) scale(1);
      opacity: 0.8;
    }
    25% {
      transform: translateY(-15px) scale(1.2);
      opacity: 1;
    }
    50% {
      transform: translateY(-25px) scale(0.8);
      opacity: 0.4;
    }
    75% {
      transform: translateY(-10px) scale(1.1);
      opacity: 0.7;
    }
  }

  /* Light rays pulse */
  .ray {
    animation: ray-pulse 2s ease-in-out infinite;
    transform-origin: center;
  }

  .ray--1 { animation-delay: 0s; }
  .ray--2 { animation-delay: 0.4s; }
  .ray--3 { animation-delay: 0.8s; }
  .ray--4 { animation-delay: 1.2s; }
  .ray--5 { animation-delay: 1.6s; }

  @keyframes ray-pulse {
    0%, 100% {
      opacity: 0.1;
      stroke-width: 1;
    }
    50% {
      opacity: 0.5;
      stroke-width: 2;
    }
  }

  /* Memory fragments float up */
  .memory {
    animation: memory-rise 5s ease-out infinite;
  }

  .memory--1 { animation-delay: 0s; }
  .memory--2 { animation-delay: 1.7s; }
  .memory--3 { animation-delay: 3.3s; }

  @keyframes memory-rise {
    0% {
      opacity: 0;
      transform: translateY(0);
    }
    20% {
      opacity: 0.4;
    }
    80% {
      opacity: 0.2;
    }
    100% {
      opacity: 0;
      transform: translateY(-40px);
    }
  }

  /* Citizen aura glow */
  .aura {
    animation: aura-glow 3s ease-in-out infinite;
  }

  @keyframes aura-glow {
    0%, 100% {
      r: 45;
      opacity: 0.1;
    }
    50% {
      r: 55;
      opacity: 0.25;
    }
  }

  /* Burst effect */
  .burst {
    animation: burst-expand 5s ease-in-out infinite;
  }

  @keyframes burst-expand {
    0%, 100% {
      transform: scale(1);
      opacity: 0.2;
    }
    50% {
      transform: scale(1.2);
      opacity: 0.4;
    }
  }

  /* Floating symbols */
  .symbol {
    animation: symbol-float 6s ease-in-out infinite;
  }

  .symbol--1 { animation-delay: 0s; }
  .symbol--2 { animation-delay: 3s; }

  @keyframes symbol-float {
    0%, 100% {
      transform: translateY(0);
      opacity: 0.1;
    }
    50% {
      transform: translateY(-10px);
      opacity: 0.2;
    }
  }

  /* Hover enhancements */
  .transformation-graphic:hover .spirit-form {
    animation-duration: 2s;
  }

  .transformation-graphic:hover .particle {
    animation-duration: 2s;
  }

  .transformation-graphic:hover .core-glow--outer,
  .transformation-graphic:hover .core-glow--inner {
    animation-duration: 2s;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .stardust-layer,
    .swirl,
    .ribbon,
    .core-glow--outer,
    .core-glow--inner,
    .spirit-form,
    .particle,
    .ray,
    .memory,
    .aura,
    .burst,
    .symbol,
    .traveling-spark animateMotion {
      animation: none;
    }

    .traveling-spark {
      display: none;
    }
  }
</style>
